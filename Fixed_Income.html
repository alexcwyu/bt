
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fixed Income Examples &#8212; bt 0.2.10 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/klink.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
         
        <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
        
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Droid+Sans+Mono:400,500,700' rel='stylesheet' type='text/css'>
    
  </head><body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fixed-income-examples">
<h1>Fixed Income Examples<a class="headerlink" href="#fixed-income-examples" title="Permalink to this heading">¶</a></h1>
<p>This example notebook illustrates some of the more sophisticated
functionality of the package, especially related to fixed income
securities and strategies. For fixed income strategies:</p>
<ul class="simple">
<li><p>capital allocations are not necessary, and initial capital is not
used</p></li>
<li><p>bankruptcy is disabled (as money can always be borrowed at some rate,
potentially represented as another asset)</p></li>
<li><p>weights are based off notional_value rather than value. For fixed
income securities, notional value is just the position. For non-fixed
income securities (i.e. equities), it is the market value of the
position.</p></li>
<li><p>strategy notional_value is always positive, equal to the sum of the
magnitudes of the notional values of all its children</p></li>
<li><p>strategy price is computed from additive PNL returns per unit of
notional_value, with a reference price of PAR</p></li>
<li><p>“rebalancing” the portfolio adjusts notionals rather than capital
allocations based on weights</p></li>
</ul>
<p>Further to the above characteristics of fixed income strategies, we also
demonstrate the usage of the following features which arise in these
types of use case:</p>
<ul class="simple">
<li><p>Coupon paying securities (i.e. bonds)</p></li>
<li><p>Handing of security lifecycle such as new issues and maturity</p></li>
<li><p>Usage of “On-The-Run” instruments, and rolling of positions into the
“new” on-the-run security at pre-defined times</p></li>
<li><p>Risk tracking/aggregation and hedging from pre-computed risk per unit
notional</p></li>
</ul>
<p>The notebook contains the following parts:</p>
<ol class="arabic simple" start="0">
<li><p><strong>Setup</strong></p></li>
<li><p><strong>Market data generation</strong></p>
<ol class="arabic simple">
<li><p>Rolling series of government bonds</p></li>
<li><p>Corporate bonds with spreads driven by a common factor</p></li>
</ol>
</li>
<li><p><strong>Example 1: Basic Strategies</strong></p>
<ol class="arabic simple">
<li><p>Weigh all active corporate bond equally</p></li>
<li><p>Add hedging of interest rates risk with the on-the-run government
bond</p></li>
</ol>
</li>
<li><p><strong>Example 2: Nested Strategies</strong></p>
<ol class="arabic simple">
<li><p>One strategy buys the top N bonds, by yield</p></li>
<li><p>Another strategy sells the bottom N bonds, by yield</p></li>
<li><p>Parent strategy gives 50% weight to each of the above</p></li>
<li><p>Add hedges of remaining interest rates risk with the on-the-run
government bond</p></li>
</ol>
</li>
</ol>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas.tseries.frequencies</span> <span class="kn">import</span> <span class="n">to_offset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># (Approximate) Price to yield calcs, and pvbp, for later use. Note we use clean price here.</span>
<span class="k">def</span> <span class="nf">price_to_yield</span><span class="p">(</span> <span class="n">p</span><span class="p">,</span> <span class="n">ttm</span><span class="p">,</span> <span class="n">coupon</span> <span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span> <span class="n">coupon</span> <span class="o">+</span> <span class="p">(</span><span class="mf">100.</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">ttm</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="p">(</span> <span class="mf">100.</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="k">def</span> <span class="nf">yield_to_price</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="n">ttm</span><span class="p">,</span> <span class="n">coupon</span> <span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">coupon</span> <span class="o">+</span> <span class="mi">100</span><span class="o">/</span><span class="n">ttm</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">y</span><span class="o">/</span><span class="mi">200</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">ttm</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pvbp</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="n">ttm</span><span class="p">,</span> <span class="n">coupon</span> <span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">yield_to_price</span><span class="p">(</span> <span class="n">y</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">ttm</span><span class="p">,</span> <span class="n">coupon</span> <span class="p">)</span> <span class="o">-</span> <span class="n">yield_to_price</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="n">ttm</span><span class="p">,</span> <span class="n">coupon</span> <span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Utility function to set data frame values to nan before the security has been issued or after it has matured</span>
<span class="k">def</span> <span class="nf">censor</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">ref_data</span> <span class="p">):</span>
    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">ref_data</span><span class="p">[</span><span class="s1">&#39;mat_date&#39;</span><span class="p">][</span><span class="n">bond</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">ref_data</span><span class="p">[</span><span class="s1">&#39;issue_date&#39;</span><span class="p">][</span><span class="n">bond</span><span class="p">]),</span> <span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Because bonds might mature during a gap in the index (i.e. on the weekend)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backtesting timeline setup</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2022-01-01&#39;</span><span class="p">)</span>
<span class="n">timeline</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="market-data-generation">
<h2>Market Data Generation<a class="headerlink" href="#market-data-generation" title="Permalink to this heading">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Government Bonds: Create synthetic data for a single series of rolling government bonds</span>

<span class="c1"># Reference Data</span>
<span class="n">roll_freq</span> <span class="o">=</span> <span class="s1">&#39;Q&#39;</span>
<span class="n">maturity</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">coupon</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">roll_dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">+</span><span class="n">to_offset</span><span class="p">(</span><span class="n">roll_freq</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="n">roll_freq</span><span class="p">)</span> <span class="c1"># Go one period beyond the end date to be safe</span>
<span class="n">issue_dates</span> <span class="o">=</span> <span class="n">roll_dates</span> <span class="o">-</span> <span class="n">roll_dates</span><span class="o">.</span><span class="n">freq</span>
<span class="n">mat_dates</span> <span class="o">=</span> <span class="n">issue_dates</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="n">maturity</span><span class="p">)</span>
<span class="n">series_name</span> <span class="o">=</span> <span class="s1">&#39;govt_10Y&#39;</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mat_dates</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;govt_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y_%m&#39;</span><span class="p">))</span>
<span class="c1"># Build a time series of OTR</span>
<span class="n">govt_otr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">roll_date</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">roll_dates</span><span class="p">)</span> <span class="k">if</span> <span class="n">roll_date</span> <span class="o">&gt;=</span><span class="n">d</span> <span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">timeline</span> <span class="p">],</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">timeline</span><span class="p">,</span>
                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">series_name</span><span class="p">])</span>
<span class="c1"># Create a data frame of reference data</span>
<span class="n">govt_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;mat_date&#39;</span><span class="p">:</span><span class="n">mat_dates</span><span class="p">,</span> <span class="s1">&#39;issue_date&#39;</span><span class="p">:</span> <span class="n">issue_dates</span><span class="p">,</span> <span class="s1">&#39;roll_date&#39;</span><span class="p">:</span><span class="n">roll_dates</span><span class="p">},</span> <span class="n">index</span> <span class="o">=</span> <span class="n">names</span><span class="p">)</span>
<span class="n">govt_data</span><span class="p">[</span><span class="s1">&#39;coupon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coupon</span>

<span class="c1"># Create the &quot;roll map&quot;</span>
<span class="n">govt_roll_map</span> <span class="o">=</span> <span class="n">govt_otr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">govt_roll_map</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">govt_otr</span><span class="p">[</span><span class="n">series_name</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">govt_roll_map</span> <span class="o">=</span> <span class="n">govt_roll_map</span><span class="p">[</span> <span class="n">govt_roll_map</span><span class="p">[</span><span class="n">series_name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">govt_roll_map</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]]</span>
<span class="n">govt_roll_map</span><span class="p">[</span><span class="s1">&#39;factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">govt_roll_map</span> <span class="o">=</span> <span class="n">govt_roll_map</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">series_name</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;date&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Market Data and Risk</span>
<span class="n">govt_yield_initial</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">govt_yield_vol</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">govt_yield</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">govt_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">timeline</span> <span class="p">)</span>
<span class="n">govt_yield_ts</span> <span class="o">=</span> <span class="p">(</span><span class="n">govt_yield_initial</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">govt_yield_vol</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">timeline</span><span class="p">))))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">govt_yield</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">govt_yield_ts</span>

<span class="n">govt_mat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">govt_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">timeline</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64&#39;</span><span class="p">)</span>
<span class="n">govt_mat</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">govt_data</span><span class="p">[</span><span class="s1">&#39;mat_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">govt_ttm</span> <span class="o">=</span> <span class="p">(</span><span class="n">govt_mat</span> <span class="o">-</span> <span class="n">timeline</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1Y&#39;</span><span class="p">)</span>
<span class="n">govt_coupon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">govt_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">timeline</span> <span class="p">)</span>
<span class="n">govt_coupon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">govt_data</span><span class="p">[</span><span class="s1">&#39;coupon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">govt_accrued</span> <span class="o">=</span> <span class="n">govt_coupon</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span> <span class="n">timeline</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1Y&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
<span class="n">govt_accrued</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">govt_price</span> <span class="o">=</span> <span class="n">yield_to_price</span><span class="p">(</span> <span class="n">govt_yield</span><span class="p">,</span> <span class="n">govt_ttm</span><span class="p">,</span> <span class="n">govt_coupon</span> <span class="p">)</span>
<span class="n">govt_price</span><span class="p">[</span> <span class="n">govt_ttm</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="mf">100.</span>
<span class="n">govt_price</span> <span class="o">=</span> <span class="n">censor</span><span class="p">(</span><span class="n">govt_price</span><span class="p">,</span> <span class="n">govt_data</span><span class="p">)</span>
<span class="n">govt_pvbp</span> <span class="o">=</span> <span class="n">pvbp</span><span class="p">(</span> <span class="n">govt_yield</span><span class="p">,</span> <span class="n">govt_ttm</span><span class="p">,</span> <span class="n">govt_coupon</span><span class="p">)</span>
<span class="n">govt_pvbp</span><span class="p">[</span> <span class="n">govt_ttm</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">govt_pvbp</span> <span class="o">=</span> <span class="n">censor</span><span class="p">(</span><span class="n">govt_pvbp</span><span class="p">,</span> <span class="n">govt_data</span><span class="p">)</span>
</pre></div>
</div>
<div class="pynb-result highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">IPython</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">interactiveshell</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3397</span><span class="p">:</span> <span class="ne">FutureWarning</span><span class="p">:</span> <span class="n">Units</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span> <span class="ow">and</span> <span class="s1">&#39;y&#39;</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">represent</span> <span class="n">unambiguous</span> <span class="n">timedelta</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">future</span> <span class="n">version</span>
   <span class="n">exec</span><span class="p">(</span><span class="n">code_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_global_ns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_ns</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Corporate Bonds: Create synthetic data for a universe of corporate bonds</span>

<span class="c1"># Reference Data</span>
<span class="n">n_corp</span> <span class="o">=</span> <span class="mi">50</span>    <span class="c1"># Number of corporate bonds to generate</span>
<span class="n">avg_ttm</span> <span class="o">=</span> <span class="mi">10</span>   <span class="c1"># Average time to maturity, in years</span>
<span class="n">coupon_mean</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">coupon_std</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">mat_dates</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">avg_ttm</span><span class="o">*</span><span class="mi">365</span><span class="p">,</span> <span class="n">n_corp</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Day</span><span class="p">()</span>
<span class="n">issue_dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span> <span class="n">mat_dates</span><span class="p">,</span> <span class="n">end_date</span> <span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">avg_ttm</span><span class="o">*</span><span class="mi">365</span><span class="p">,</span> <span class="n">n_corp</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Day</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span> <span class="p">[</span> <span class="s1">&#39;corp</span><span class="si">{:04d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_corp</span><span class="p">)])</span>
<span class="n">coupons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span> <span class="n">coupon_mean</span><span class="p">,</span> <span class="n">coupon_std</span><span class="p">,</span> <span class="n">n_corp</span> <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">corp_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;mat_date&#39;</span><span class="p">:</span><span class="n">mat_dates</span><span class="p">,</span> <span class="s1">&#39;issue_date&#39;</span><span class="p">:</span> <span class="n">issue_dates</span><span class="p">,</span> <span class="s1">&#39;coupon&#39;</span><span class="p">:</span><span class="n">coupons</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>

<span class="c1"># Market Data and Risk</span>
<span class="c1"># Model: corporate yield = government yield + credit spread</span>
<span class="c1"># Model: credit spread changes = beta * common factor changes + idiosyncratic changes</span>
<span class="n">corp_spread_initial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corp_data</span><span class="p">)</span> <span class="p">)</span>
<span class="n">corp_betas_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corp_data</span><span class="p">)</span> <span class="p">)</span>
<span class="n">corp_factor_vol</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">corp_idio_vol</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">corp_factor_ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">corp_factor_vol</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">timeline</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">corp_idio_ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">corp_idio_vol</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">timeline</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">corp_spread</span> <span class="o">=</span> <span class="n">corp_spread_initial</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span> <span class="n">corp_factor_ts</span><span class="p">,</span> <span class="n">corp_betas_raw</span> <span class="p">)</span> <span class="o">+</span> <span class="n">corp_idio_ts</span>
<span class="n">corp_yield</span> <span class="o">=</span> <span class="n">govt_yield_ts</span> <span class="o">+</span> <span class="n">corp_spread</span>
<span class="n">corp_yield</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>  <span class="n">columns</span> <span class="o">=</span> <span class="n">corp_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">timeline</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">corp_yield</span> <span class="p">)</span>

<span class="n">corp_mat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">corp_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">timeline</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">start_date</span> <span class="p">)</span>
<span class="n">corp_mat</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">corp_data</span><span class="p">[</span><span class="s1">&#39;mat_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">corp_ttm</span> <span class="o">=</span> <span class="p">(</span><span class="n">corp_mat</span> <span class="o">-</span> <span class="n">timeline</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1Y&#39;</span><span class="p">)</span>
<span class="n">corp_coupon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">corp_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">timeline</span> <span class="p">)</span>
<span class="n">corp_coupon</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">corp_data</span><span class="p">[</span><span class="s1">&#39;coupon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">corp_accrued</span> <span class="o">=</span> <span class="n">corp_coupon</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span> <span class="n">timeline</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1Y&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
<span class="n">corp_accrued</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">corp_price</span> <span class="o">=</span> <span class="n">yield_to_price</span><span class="p">(</span> <span class="n">corp_yield</span><span class="p">,</span> <span class="n">corp_ttm</span><span class="p">,</span> <span class="n">corp_coupon</span> <span class="p">)</span>
<span class="n">corp_price</span><span class="p">[</span> <span class="n">corp_ttm</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="mf">100.</span>
<span class="n">corp_price</span> <span class="o">=</span> <span class="n">censor</span><span class="p">(</span><span class="n">corp_price</span><span class="p">,</span> <span class="n">corp_data</span><span class="p">)</span>

<span class="n">corp_pvbp</span> <span class="o">=</span> <span class="n">pvbp</span><span class="p">(</span> <span class="n">corp_yield</span><span class="p">,</span> <span class="n">corp_ttm</span><span class="p">,</span> <span class="n">corp_coupon</span><span class="p">)</span>
<span class="n">corp_pvbp</span><span class="p">[</span> <span class="n">corp_ttm</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">corp_pvbp</span> <span class="o">=</span> <span class="n">censor</span><span class="p">(</span><span class="n">corp_pvbp</span><span class="p">,</span> <span class="n">corp_data</span><span class="p">)</span>

<span class="n">bidoffer_bps</span> <span class="o">=</span> <span class="mf">5.</span>
<span class="n">corp_bidoffer</span> <span class="o">=</span> <span class="o">-</span><span class="n">bidoffer_bps</span> <span class="o">*</span> <span class="n">corp_pvbp</span>

<span class="n">corp_betas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">corp_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">timeline</span> <span class="p">)</span>
<span class="n">corp_betas</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">corp_betas_raw</span>
<span class="n">corp_betas</span> <span class="o">=</span> <span class="n">censor</span><span class="p">(</span><span class="n">corp_betas</span><span class="p">,</span> <span class="n">corp_data</span><span class="p">)</span>
</pre></div>
</div>
<div class="pynb-result highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">IPython</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">interactiveshell</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3397</span><span class="p">:</span> <span class="ne">FutureWarning</span><span class="p">:</span> <span class="n">Units</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span> <span class="ow">and</span> <span class="s1">&#39;y&#39;</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">represent</span> <span class="n">unambiguous</span> <span class="n">timedelta</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">future</span> <span class="n">version</span>
   <span class="n">exec</span><span class="p">(</span><span class="n">code_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_global_ns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_ns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-1-basic-strategies">
<h2>Example 1: Basic Strategies<a class="headerlink" href="#example-1-basic-strategies" title="Permalink to this heading">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a strategy and a backtest</span>

<span class="c1"># The goal here is to define an equal weighted portfolio of corporate bonds,</span>
<span class="c1"># and to hedge the rates risk with the rolling series of government bonds</span>

<span class="c1"># Define Algo Stacks as the various building blocks</span>
<span class="c1"># Note that the order in which we execute these is extremely important</span>

<span class="n">lifecycle_stack</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AlgoStack</span><span class="p">(</span>
    <span class="c1"># Close any matured bond positions (including hedges)</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">ClosePositionsAfterDates</span><span class="p">(</span> <span class="s1">&#39;maturity&#39;</span> <span class="p">),</span>
    <span class="c1"># Roll government bond positions into the On The Run</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RollPositionsAfterDates</span><span class="p">(</span> <span class="s1">&#39;govt_roll_map&#39;</span> <span class="p">),</span>
<span class="p">)</span>
<span class="n">risk_stack</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">AlgoStack</span><span class="p">(</span>
    <span class="c1"># Specify how frequently to calculate risk</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span> <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunWeekly</span><span class="p">(),</span>
                  <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">()]</span> <span class="p">),</span>
    <span class="c1"># Update the risk given any positions that have been put on so far in the current step</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">UpdateRisk</span><span class="p">(</span> <span class="s1">&#39;pvbp&#39;</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">UpdateRisk</span><span class="p">(</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">hedging_stack</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">AlgoStack</span><span class="p">(</span>
    <span class="c1"># Specify how frequently to hedge risk</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
    <span class="c1"># Select the &quot;alias&quot; for the on-the-run government bond...</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectThese</span><span class="p">(</span> <span class="p">[</span><span class="n">series_name</span><span class="p">],</span> <span class="n">include_no_data</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">),</span>
    <span class="c1"># ... and then resolve it to the underlying security for the given date</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">ResolveOnTheRun</span><span class="p">(</span> <span class="s1">&#39;govt_otr&#39;</span> <span class="p">),</span>
    <span class="c1"># Hedge out the pvbp risk using the selected government bond</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">HedgeRisks</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;pvbp&#39;</span><span class="p">]),</span>
    <span class="c1"># Need to update risk again after hedging so that it gets recorded correctly (post-hedges)</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">UpdateRisk</span><span class="p">(</span> <span class="s1">&#39;pvbp&#39;</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">debug_stack</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AlgoStack</span><span class="p">(</span>
    <span class="c1"># Specify how frequently to display debug info</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s1">&#39;Strategy </span><span class="si">{name}</span><span class="s1"> : </span><span class="si">{now}</span><span class="s1">.</span><span class="se">\t</span><span class="s1">Notional:  </span><span class="si">{_notl_value:0.0f}</span><span class="s1">,</span><span class="se">\t</span><span class="s1"> Value: </span><span class="si">{_value:0.0f}</span><span class="s1">,</span><span class="se">\t</span><span class="s1"> Price: </span><span class="si">{_price:0.4f}</span><span class="s1">&#39;</span><span class="p">),</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">PrintRisk</span><span class="p">(</span><span class="s1">&#39;Risk: </span><span class="se">\t</span><span class="s1">PVBP: </span><span class="si">{pvbp:0.0f}</span><span class="s1">,</span><span class="se">\t</span><span class="s1"> Beta: </span><span class="si">{beta:0.0f}</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">trading_stack</span> <span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AlgoStack</span><span class="p">(</span>
         <span class="c1"># Specify how frequently to rebalance the portfolio</span>
         <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
         <span class="c1"># Select instruments for rebalancing. Start with everything</span>
         <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectAll</span><span class="p">(),</span>
         <span class="c1"># Prevent matured/rolled instruments from coming back into the mix</span>
         <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectActive</span><span class="p">(),</span>
         <span class="c1"># Select only corp instruments</span>
         <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectRegex</span><span class="p">(</span> <span class="s1">&#39;corp&#39;</span> <span class="p">),</span>
         <span class="c1"># Specify how to weigh the securities</span>
         <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighEqually</span><span class="p">(),</span>
         <span class="c1"># Set the target portfolio size</span>
         <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SetNotional</span><span class="p">(</span> <span class="s1">&#39;notional_value&#39;</span> <span class="p">),</span>
         <span class="c1"># Rebalance the portfolio</span>
         <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">govt_securities</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bt</span><span class="o">.</span><span class="n">CouponPayingHedgeSecurity</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">govt_data</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">corp_securities</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bt</span><span class="o">.</span><span class="n">CouponPayingSecurity</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">corp_data</span><span class="o">.</span><span class="n">index</span> <span class="p">]</span>
<span class="n">securities</span> <span class="o">=</span> <span class="n">govt_securities</span> <span class="o">+</span> <span class="n">corp_securities</span>
<span class="n">base_strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">FixedIncomeStrategy</span><span class="p">(</span><span class="s1">&#39;BaseStrategy&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="n">lifecycle_stack</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span> <span class="p">[</span><span class="n">trading_stack</span><span class="p">,</span> <span class="n">risk_stack</span><span class="p">,</span> <span class="n">debug_stack</span> <span class="p">]</span> <span class="p">)</span> <span class="p">],</span> <span class="n">children</span> <span class="o">=</span> <span class="n">securities</span><span class="p">)</span>
<span class="n">hedged_strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">FixedIncomeStrategy</span><span class="p">(</span><span class="s1">&#39;HedgedStrategy&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="n">lifecycle_stack</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span> <span class="p">[</span><span class="n">trading_stack</span><span class="p">,</span> <span class="n">risk_stack</span><span class="p">,</span> <span class="n">hedging_stack</span><span class="p">,</span> <span class="n">debug_stack</span> <span class="p">]</span> <span class="p">)</span> <span class="p">],</span> <span class="n">children</span> <span class="o">=</span> <span class="n">securities</span><span class="p">)</span>

<span class="c1">#Collect all the data for the strategies</span>

<span class="c1"># Here we use clean prices as the data and accrued as the coupon. Could alternatively use dirty prices and cashflows.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span> <span class="p">[</span> <span class="n">govt_price</span><span class="p">,</span> <span class="n">corp_price</span> <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.</span>  <span class="c1"># Because we need prices per unit notional</span>
<span class="n">additional_data</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;coupons&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">govt_accrued</span><span class="p">,</span> <span class="n">corp_accrued</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">,</span>
                   <span class="s1">&#39;bidoffer&#39;</span> <span class="p">:</span> <span class="n">corp_bidoffer</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span>
                   <span class="s1">&#39;notional_value&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="p">),</span>
                   <span class="s1">&#39;maturity&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">govt_data</span><span class="p">,</span> <span class="n">corp_data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mat_date&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">}),</span>
                   <span class="s1">&#39;govt_roll_map&#39;</span> <span class="p">:</span> <span class="n">govt_roll_map</span><span class="p">,</span>
                   <span class="s1">&#39;govt_otr&#39;</span> <span class="p">:</span> <span class="n">govt_otr</span><span class="p">,</span>
                   <span class="s1">&#39;unit_risk&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;pvbp&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span> <span class="p">[</span> <span class="n">govt_pvbp</span><span class="p">,</span> <span class="n">corp_pvbp</span><span class="p">]</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span>
                                  <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">corp_betas</span> <span class="o">*</span> <span class="n">corp_pvbp</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">},</span>
                  <span class="p">}</span>
<span class="n">base_test</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span> <span class="n">base_strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;BaseBacktest&#39;</span><span class="p">,</span>
                <span class="n">initial_capital</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">additional_data</span> <span class="o">=</span> <span class="n">additional_data</span> <span class="p">)</span>
<span class="n">hedge_test</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span> <span class="n">hedged_strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;HedgedBacktest&#39;</span><span class="p">,</span>
                <span class="n">initial_capital</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">additional_data</span> <span class="o">=</span> <span class="n">additional_data</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span> <span class="n">base_test</span><span class="p">,</span> <span class="n">hedge_test</span> <span class="p">)</span>
</pre></div>
</div>
<div class="pynb-result highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">1644</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">99.8356</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">658</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">659</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">6454</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">99.3546</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">642</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">643</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">26488</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">97.3512</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">611</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">613</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">20295</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">97.9705</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">607</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">608</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">43692</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">95.6308</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">573</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">574</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">41095</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">95.8905</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">566</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">566</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">15724</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">98.4985</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">609</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">608</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">22308</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">97.8400</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">587</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">594</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">12832</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.4263</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">644</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">650</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">35263</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">103.6965</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">683</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">680</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">3702</span><span class="p">,</span>    <span class="n">Price</span><span class="p">:</span> <span class="mf">100.5404</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">638</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">646</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">18534</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">98.3168</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">606</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">613</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">11054</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">99.0648</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">603</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">609</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">16424</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">98.5537</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">602</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">609</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">34462</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">96.6943</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">603</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">586</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">23533</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">97.7872</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">603</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">586</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">27024</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">97.4381</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">590</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">574</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">50723</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">95.0682</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">558</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">541</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">52714</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">94.8690</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">547</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">528</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">53039</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">94.8067</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">550</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">531</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">39027</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">96.2079</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">550</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">524</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">2051</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">99.9002</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">588</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">561</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">8616</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">99.2438</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">573</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">544</span>
 <span class="n">Strategy</span> <span class="n">BaseStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>        <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">53520</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">105.6538</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">656</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">623</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">1644</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">99.8356</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">659</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">10996</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">98.9004</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">643</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">16765</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">98.3235</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">613</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">21649</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">97.8351</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">608</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">33399</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">96.6601</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">574</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">22927</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">97.7073</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">566</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="o">-</span><span class="mi">14965</span><span class="p">,</span>  <span class="n">Price</span><span class="p">:</span> <span class="mf">98.5366</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">608</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">5092</span><span class="p">,</span>    <span class="n">Price</span><span class="p">:</span> <span class="mf">100.5423</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">594</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">22278</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">102.2828</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">650</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">13903</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.4286</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">680</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">12081</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.2464</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">646</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">10531</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.0914</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">613</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">12144</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.2528</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">609</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">15903</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.6469</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">609</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">11958</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.2204</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">586</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">28170</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">102.8417</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">586</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">34561</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">103.4807</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">574</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">29233</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">102.9479</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">541</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">10323</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.0569</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">528</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">14539</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.4646</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">531</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">10754</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.0860</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">524</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">32502</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">103.2515</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">561</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">24506</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">102.4519</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">544</span>
 <span class="n">Strategy</span> <span class="n">HedgedStrategy</span> <span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.</span>      <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">42093</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">104.2905</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">623</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract Tear Sheet for base backtest</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;BaseBacktest&#39;</span><span class="p">]</span>
<span class="n">stats</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<div class="pynb-result highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">Stats</span> <span class="k">for</span> <span class="n">BaseBacktest</span> <span class="kn">from</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
 <span class="n">Annual</span> <span class="n">risk</span><span class="o">-</span><span class="n">free</span> <span class="n">rate</span> <span class="n">considered</span><span class="p">:</span> <span class="mf">0.00</span><span class="o">%</span>
 <span class="n">Summary</span><span class="p">:</span>
 <span class="n">Total</span> <span class="n">Return</span>      <span class="n">Sharpe</span>  <span class="n">CAGR</span>    <span class="n">Max</span> <span class="n">Drawdown</span>
 <span class="o">--------------</span>  <span class="o">--------</span>  <span class="o">------</span>  <span class="o">--------------</span>
 <span class="mf">2.34</span><span class="o">%</span>               <span class="mf">0.19</span>  <span class="mf">1.16</span><span class="o">%</span>   <span class="o">-</span><span class="mf">10.64</span><span class="o">%</span>

 <span class="n">Annualized</span> <span class="n">Returns</span><span class="p">:</span>
 <span class="n">mtd</span>     <span class="mi">3</span><span class="n">m</span>     <span class="mi">6</span><span class="n">m</span>     <span class="n">ytd</span>    <span class="mi">1</span><span class="n">y</span>     <span class="mi">3</span><span class="n">y</span>     <span class="mi">5</span><span class="n">y</span>    <span class="mi">10</span><span class="n">y</span>    <span class="n">incep</span><span class="o">.</span>
 <span class="o">------</span>  <span class="o">-----</span>  <span class="o">-----</span>  <span class="o">-----</span>  <span class="o">-----</span>  <span class="o">-----</span>  <span class="o">----</span>  <span class="o">-----</span>  <span class="o">--------</span>
 <span class="o">-</span><span class="mf">3.06</span><span class="o">%</span>  <span class="mf">1.45</span><span class="o">%</span>  <span class="mf">8.12</span><span class="o">%</span>  <span class="mf">3.43</span><span class="o">%</span>  <span class="mf">3.43</span><span class="o">%</span>  <span class="mf">1.16</span><span class="o">%</span>  <span class="o">-</span>     <span class="o">-</span>      <span class="mf">1.16</span><span class="o">%</span>

 <span class="n">Periodic</span><span class="p">:</span>
         <span class="n">daily</span>    <span class="n">monthly</span>    <span class="n">yearly</span>
 <span class="o">------</span>  <span class="o">-------</span>  <span class="o">---------</span>  <span class="o">--------</span>
 <span class="n">sharpe</span>  <span class="mf">0.19</span>     <span class="mf">0.18</span>       <span class="mf">0.38</span>
 <span class="n">mean</span>    <span class="mf">1.38</span><span class="o">%</span>    <span class="mf">1.49</span><span class="o">%</span>      <span class="mf">1.19</span><span class="o">%</span>
 <span class="n">vol</span>     <span class="mf">7.26</span><span class="o">%</span>    <span class="mf">8.35</span><span class="o">%</span>      <span class="mf">3.17</span><span class="o">%</span>
 <span class="n">skew</span>    <span class="mf">0.16</span>     <span class="mf">0.75</span>       <span class="o">-</span>
 <span class="n">kurt</span>    <span class="mf">0.52</span>     <span class="mf">0.70</span>       <span class="o">-</span>
 <span class="n">best</span>    <span class="mf">1.59</span><span class="o">%</span>    <span class="mf">6.32</span><span class="o">%</span>      <span class="mf">3.43</span><span class="o">%</span>
 <span class="n">worst</span>   <span class="o">-</span><span class="mf">1.44</span><span class="o">%</span>   <span class="o">-</span><span class="mf">3.29</span><span class="o">%</span>     <span class="o">-</span><span class="mf">1.05</span><span class="o">%</span>

 <span class="n">Drawdowns</span><span class="p">:</span>
 <span class="nb">max</span>      <span class="n">avg</span>       <span class="c1"># days</span>
 <span class="o">-------</span>  <span class="o">------</span>  <span class="o">--------</span>
 <span class="o">-</span><span class="mf">10.64</span><span class="o">%</span>  <span class="o">-</span><span class="mf">2.59</span><span class="o">%</span>     <span class="mf">79.22</span>

 <span class="n">Misc</span><span class="p">:</span>
 <span class="o">---------------</span>  <span class="o">------</span>
 <span class="n">avg</span><span class="o">.</span> <span class="n">up</span> <span class="n">month</span>    <span class="mf">1.88</span><span class="o">%</span>
 <span class="n">avg</span><span class="o">.</span> <span class="n">down</span> <span class="n">month</span>  <span class="o">-</span><span class="mf">1.63</span><span class="o">%</span>
 <span class="n">up</span> <span class="n">year</span> <span class="o">%</span>        <span class="mf">50.00</span><span class="o">%</span>
 <span class="mi">12</span><span class="n">m</span> <span class="n">up</span> <span class="o">%</span>         <span class="mf">57.14</span><span class="o">%</span>
 <span class="o">---------------</span>  <span class="o">------</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract Tear Sheet for hedged backtest</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;HedgedBacktest&#39;</span><span class="p">]</span>
<span class="n">stats</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<div class="pynb-result highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">Stats</span> <span class="k">for</span> <span class="n">HedgedBacktest</span> <span class="kn">from</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
 <span class="n">Annual</span> <span class="n">risk</span><span class="o">-</span><span class="n">free</span> <span class="n">rate</span> <span class="n">considered</span><span class="p">:</span> <span class="mf">0.00</span><span class="o">%</span>
 <span class="n">Summary</span><span class="p">:</span>
 <span class="n">Total</span> <span class="n">Return</span>      <span class="n">Sharpe</span>  <span class="n">CAGR</span>    <span class="n">Max</span> <span class="n">Drawdown</span>
 <span class="o">--------------</span>  <span class="o">--------</span>  <span class="o">------</span>  <span class="o">--------------</span>
 <span class="mf">3.51</span><span class="o">%</span>               <span class="mf">0.41</span>  <span class="mf">1.74</span><span class="o">%</span>   <span class="o">-</span><span class="mf">3.87</span><span class="o">%</span>

 <span class="n">Annualized</span> <span class="n">Returns</span><span class="p">:</span>
 <span class="n">mtd</span>     <span class="mi">3</span><span class="n">m</span>      <span class="mi">6</span><span class="n">m</span>     <span class="n">ytd</span>    <span class="mi">1</span><span class="n">y</span>     <span class="mi">3</span><span class="n">y</span>     <span class="mi">5</span><span class="n">y</span>    <span class="mi">10</span><span class="n">y</span>    <span class="n">incep</span><span class="o">.</span>
 <span class="o">------</span>  <span class="o">------</span>  <span class="o">-----</span>  <span class="o">-----</span>  <span class="o">-----</span>  <span class="o">-----</span>  <span class="o">----</span>  <span class="o">-----</span>  <span class="o">--------</span>
 <span class="o">-</span><span class="mf">0.47</span><span class="o">%</span>  <span class="o">-</span><span class="mf">0.30</span><span class="o">%</span>  <span class="mf">2.29</span><span class="o">%</span>  <span class="mf">2.46</span><span class="o">%</span>  <span class="mf">2.46</span><span class="o">%</span>  <span class="mf">1.74</span><span class="o">%</span>  <span class="o">-</span>     <span class="o">-</span>      <span class="mf">1.74</span><span class="o">%</span>

 <span class="n">Periodic</span><span class="p">:</span>
         <span class="n">daily</span>    <span class="n">monthly</span>    <span class="n">yearly</span>
 <span class="o">------</span>  <span class="o">-------</span>  <span class="o">---------</span>  <span class="o">--------</span>
 <span class="n">sharpe</span>  <span class="mf">0.41</span>     <span class="mf">0.43</span>       <span class="mf">1.71</span>
 <span class="n">mean</span>    <span class="mf">1.75</span><span class="o">%</span>    <span class="mf">1.81</span><span class="o">%</span>      <span class="mf">1.74</span><span class="o">%</span>
 <span class="n">vol</span>     <span class="mf">4.26</span><span class="o">%</span>    <span class="mf">4.22</span><span class="o">%</span>      <span class="mf">1.02</span><span class="o">%</span>
 <span class="n">skew</span>    <span class="o">-</span><span class="mf">0.17</span>    <span class="mf">0.67</span>       <span class="o">-</span>
 <span class="n">kurt</span>    <span class="mf">0.21</span>     <span class="o">-</span><span class="mf">0.46</span>      <span class="o">-</span>
 <span class="n">best</span>    <span class="mf">0.69</span><span class="o">%</span>    <span class="mf">2.82</span><span class="o">%</span>      <span class="mf">2.46</span><span class="o">%</span>
 <span class="n">worst</span>   <span class="o">-</span><span class="mf">1.07</span><span class="o">%</span>   <span class="o">-</span><span class="mf">1.62</span><span class="o">%</span>     <span class="mf">1.02</span><span class="o">%</span>

 <span class="n">Drawdowns</span><span class="p">:</span>
 <span class="nb">max</span>     <span class="n">avg</span>       <span class="c1"># days</span>
 <span class="o">------</span>  <span class="o">------</span>  <span class="o">--------</span>
 <span class="o">-</span><span class="mf">3.87</span><span class="o">%</span>  <span class="o">-</span><span class="mf">1.02</span><span class="o">%</span>     <span class="mf">49.57</span>

 <span class="n">Misc</span><span class="p">:</span>
 <span class="o">---------------</span>  <span class="o">-------</span>
 <span class="n">avg</span><span class="o">.</span> <span class="n">up</span> <span class="n">month</span>    <span class="mf">1.25</span><span class="o">%</span>
 <span class="n">avg</span><span class="o">.</span> <span class="n">down</span> <span class="n">month</span>  <span class="o">-</span><span class="mf">0.78</span><span class="o">%</span>
 <span class="n">up</span> <span class="n">year</span> <span class="o">%</span>        <span class="mf">100.00</span><span class="o">%</span>
 <span class="mi">12</span><span class="n">m</span> <span class="n">up</span> <span class="o">%</span>         <span class="mf">85.71</span><span class="o">%</span>
 <span class="o">---------------</span>  <span class="o">-------</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Total PNL time series values</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;hedged&#39;</span><span class="p">:</span><span class="n">hedge_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">values</span><span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<a class="pynb reference internal image-reference" href="_images/Fixed_Income_13_0.png"><img alt="_images/Fixed_Income_13_0.png" class="pynb" src="_images/Fixed_Income_13_0.png" style="width: 395px; height: 262px;" /></a>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Total risk time series values</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;base_pvbp&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;pvbp&#39;</span><span class="p">],</span>
               <span class="s1">&#39;hedged_pvbp&#39;</span><span class="p">:</span><span class="n">hedge_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;pvbp&#39;</span><span class="p">],</span>
               <span class="s1">&#39;beta&#39;</span><span class="p">:</span><span class="n">hedge_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]}</span> <span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<a class="pynb reference internal image-reference" href="_images/Fixed_Income_14_0.png"><img alt="_images/Fixed_Income_14_0.png" class="pynb" src="_images/Fixed_Income_14_0.png" style="width: 383px; height: 248px;" /></a>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Total bid/offer paid (same for both strategies)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;base_pvbp&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">bidoffers_paid</span><span class="p">,</span>
               <span class="s1">&#39;hedged_pvbp&#39;</span><span class="p">:</span><span class="n">hedge_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">bidoffers_paid</span> <span class="p">})</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<a class="pynb reference internal image-reference" href="_images/Fixed_Income_15_0.png"><img alt="_images/Fixed_Income_15_0.png" class="pynb" src="_images/Fixed_Income_15_0.png" style="width: 383px; height: 262px;" /></a>
</div>
<div class="section" id="example-2-nested-strategies">
<h2>Example 2: Nested Strategies<a class="headerlink" href="#example-2-nested-strategies" title="Permalink to this heading">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a more complex strategy and a backtest</span>

<span class="c1"># The goal of the more complex strategy is to define two sub-strategies of corporate bonds</span>
<span class="c1"># - Highest yield bonds</span>
<span class="c1"># - Lowest yield bonds</span>
<span class="c1"># Then we will go long the high yield bonds, short the low yield bonds in equal weight</span>
<span class="c1"># Lastly we will hedge the rates risk with the government bond</span>

<span class="n">govt_securities</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bt</span><span class="o">.</span><span class="n">CouponPayingHedgeSecurity</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">govt_data</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">corp_securities</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bt</span><span class="o">.</span><span class="n">CouponPayingSecurity</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">corp_data</span><span class="o">.</span><span class="n">index</span> <span class="p">]</span>

<span class="k">def</span> <span class="nf">get_algos</span><span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">sort_descending</span> <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Helper function to return the algos for long or short portfolio, based on top n yields&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="c1"># Close any matured bond positions</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">ClosePositionsAfterDates</span><span class="p">(</span> <span class="s1">&#39;corp_maturity&#39;</span> <span class="p">),</span>
        <span class="c1"># Specify how frequenty to rebalance</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
        <span class="c1"># Select instruments for rebalancing. Start with everything</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectAll</span><span class="p">(),</span>
        <span class="c1"># Prevent matured/rolled instruments from coming back into the mix</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectActive</span><span class="p">(),</span>
        <span class="c1"># Set the stat to be used for selection</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SetStat</span><span class="p">(</span> <span class="s1">&#39;corp_yield&#39;</span> <span class="p">),</span>
        <span class="c1"># Select the top N yielding bonds</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectN</span><span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">sort_descending</span><span class="p">,</span> <span class="n">filter_selected</span><span class="o">=</span><span class="kc">True</span> <span class="p">),</span>
        <span class="c1"># Specify how to weigh the securities</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighEqually</span><span class="p">(),</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">ScaleWeights</span><span class="p">(</span><span class="mf">1.</span> <span class="k">if</span> <span class="n">sort_descending</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span><span class="p">),</span> <span class="c1"># Determine long/short</span>
        <span class="c1"># Set the target portfolio size</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SetNotional</span><span class="p">(</span> <span class="s1">&#39;notional_value&#39;</span> <span class="p">),</span>
        <span class="c1"># Rebalance the portfolio</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">(),</span>
    <span class="p">]</span>
<span class="n">bottom_algos</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">top_strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">FixedIncomeStrategy</span><span class="p">(</span><span class="s1">&#39;TopStrategy&#39;</span><span class="p">,</span> <span class="n">get_algos</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">True</span> <span class="p">),</span> <span class="n">children</span> <span class="o">=</span> <span class="n">corp_securities</span><span class="p">)</span>
<span class="n">bottom_strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">FixedIncomeStrategy</span><span class="p">(</span><span class="s1">&#39;BottomStrategy&#39;</span><span class="p">,</span><span class="n">get_algos</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">False</span> <span class="p">),</span> <span class="n">children</span> <span class="o">=</span> <span class="n">corp_securities</span><span class="p">)</span>

<span class="n">risk_stack</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">AlgoStack</span><span class="p">(</span>
    <span class="c1"># Specify how frequently to calculate risk</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span> <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunWeekly</span><span class="p">(),</span>
                  <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">()]</span> <span class="p">),</span>
    <span class="c1"># Update the risk given any positions that have been put on so far in the current step</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">UpdateRisk</span><span class="p">(</span> <span class="s1">&#39;pvbp&#39;</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">UpdateRisk</span><span class="p">(</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">hedging_stack</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">AlgoStack</span><span class="p">(</span>
    <span class="c1"># Close any matured hedge positions (including hedges)</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">ClosePositionsAfterDates</span><span class="p">(</span> <span class="s1">&#39;govt_maturity&#39;</span> <span class="p">),</span>
    <span class="c1"># Roll government bond positions into the On The Run</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RollPositionsAfterDates</span><span class="p">(</span> <span class="s1">&#39;govt_roll_map&#39;</span> <span class="p">),</span>
    <span class="c1"># Specify how frequently to hedge risk</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
    <span class="c1"># Select the &quot;alias&quot; for the on-the-run government bond...</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectThese</span><span class="p">(</span> <span class="p">[</span><span class="n">series_name</span><span class="p">],</span> <span class="n">include_no_data</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">),</span>
    <span class="c1"># ... and then resolve it to the underlying security for the given date</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">ResolveOnTheRun</span><span class="p">(</span> <span class="s1">&#39;govt_otr&#39;</span> <span class="p">),</span>
    <span class="c1"># Hedge out the pvbp risk using the selected government bond</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">HedgeRisks</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;pvbp&#39;</span><span class="p">]),</span>
    <span class="c1"># Need to update risk again after hedging so that it gets recorded correctly (post-hedges)</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">UpdateRisk</span><span class="p">(</span> <span class="s1">&#39;pvbp&#39;</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">debug_stack</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AlgoStack</span><span class="p">(</span>
    <span class="c1"># Specify how frequently to display debug info</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{now}</span><span class="s1">: End   </span><span class="si">{name}</span><span class="se">\t</span><span class="s1">Notional:  </span><span class="si">{_notl_value:0.0f}</span><span class="s1">,</span><span class="se">\t</span><span class="s1"> Value: </span><span class="si">{_value:0.0f}</span><span class="s1">,</span><span class="se">\t</span><span class="s1"> Price: </span><span class="si">{_price:0.4f}</span><span class="s1">&#39;</span><span class="p">),</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">PrintRisk</span><span class="p">(</span><span class="s1">&#39;Risk: </span><span class="se">\t</span><span class="s1">PVBP: </span><span class="si">{pvbp:0.0f}</span><span class="s1">,</span><span class="se">\t</span><span class="s1"> Beta: </span><span class="si">{beta:0.0f}</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">trading_stack</span> <span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AlgoStack</span><span class="p">(</span>
    <span class="c1"># Specify how frequently to rebalance the portfolio of sub-strategies</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunOnce</span><span class="p">(),</span>
    <span class="c1"># Specify how to weigh the sub-strategies</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighSpecified</span><span class="p">(</span> <span class="n">TopStrategy</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">BottomStrategy</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="c1"># Rebalance the portfolio</span>
    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">children</span> <span class="o">=</span> <span class="p">[</span> <span class="n">top_strategy</span><span class="p">,</span> <span class="n">bottom_strategy</span> <span class="p">]</span> <span class="o">+</span> <span class="n">govt_securities</span>
<span class="n">base_strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">FixedIncomeStrategy</span><span class="p">(</span><span class="s1">&#39;BaseStrategy&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span> <span class="p">[</span><span class="n">trading_stack</span><span class="p">,</span> <span class="n">risk_stack</span><span class="p">,</span> <span class="n">debug_stack</span> <span class="p">]</span> <span class="p">)</span> <span class="p">],</span> <span class="n">children</span> <span class="o">=</span> <span class="n">children</span><span class="p">)</span>
<span class="n">hedged_strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">FixedIncomeStrategy</span><span class="p">(</span><span class="s1">&#39;HedgedStrategy&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span> <span class="p">[</span><span class="n">trading_stack</span><span class="p">,</span> <span class="n">risk_stack</span><span class="p">,</span> <span class="n">hedging_stack</span><span class="p">,</span> <span class="n">debug_stack</span> <span class="p">]</span> <span class="p">)</span> <span class="p">],</span> <span class="n">children</span> <span class="o">=</span> <span class="n">children</span><span class="p">)</span>

<span class="c1"># Here we use clean prices as the data and accrued as the coupon. Could alternatively use dirty prices and cashflows.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span> <span class="p">[</span> <span class="n">govt_price</span><span class="p">,</span> <span class="n">corp_price</span> <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.</span>  <span class="c1"># Because we need prices per unit notional</span>
<span class="n">additional_data</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;coupons&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">govt_accrued</span><span class="p">,</span> <span class="n">corp_accrued</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">,</span> <span class="c1"># Because we need coupons per unit notional</span>
                   <span class="s1">&#39;notional_value&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="p">),</span>
                   <span class="s1">&#39;govt_maturity&#39;</span> <span class="p">:</span> <span class="n">govt_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mat_date&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">}),</span>
                   <span class="s1">&#39;corp_maturity&#39;</span> <span class="p">:</span> <span class="n">corp_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mat_date&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">}),</span>
                   <span class="s1">&#39;govt_roll_map&#39;</span> <span class="p">:</span> <span class="n">govt_roll_map</span><span class="p">,</span>
                   <span class="s1">&#39;govt_otr&#39;</span> <span class="p">:</span> <span class="n">govt_otr</span><span class="p">,</span>
                   <span class="s1">&#39;corp_yield&#39;</span> <span class="p">:</span> <span class="n">corp_yield</span><span class="p">,</span>
                   <span class="s1">&#39;unit_risk&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;pvbp&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span> <span class="p">[</span> <span class="n">govt_pvbp</span><span class="p">,</span> <span class="n">corp_pvbp</span><span class="p">]</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span>
                                  <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">corp_betas</span> <span class="o">*</span> <span class="n">corp_pvbp</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">},</span>
                  <span class="p">}</span>
<span class="n">base_test</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span> <span class="n">base_strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;BaseBacktest&#39;</span><span class="p">,</span>
                <span class="n">initial_capital</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">additional_data</span> <span class="o">=</span> <span class="n">additional_data</span><span class="p">)</span>
<span class="n">hedge_test</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span> <span class="n">hedged_strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;HedgedBacktest&#39;</span><span class="p">,</span>
                <span class="n">initial_capital</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">additional_data</span> <span class="o">=</span> <span class="n">additional_data</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span> <span class="n">base_test</span><span class="p">,</span> <span class="n">hedge_test</span> <span class="p">)</span>
</pre></div>
</div>
<div class="pynb-result highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>    <span class="n">Value</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>       <span class="n">Price</span><span class="p">:</span> <span class="mf">100.0000</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">0</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">3277</span><span class="p">,</span>    <span class="n">Price</span><span class="p">:</span> <span class="mf">100.1639</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="mi">41</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">7297</span><span class="p">,</span>    <span class="n">Price</span><span class="p">:</span> <span class="mf">100.3649</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="mi">34</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">9336</span><span class="p">,</span>    <span class="n">Price</span><span class="p">:</span> <span class="mf">100.4668</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="mi">34</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">13453</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.6727</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="mi">28</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">15887</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.7943</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="mi">26</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1800000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">16024</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.8010</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="mi">28</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">14785</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.7391</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">152</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">124</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1800000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">30310</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.5550</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">263</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">204</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">35915</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.8430</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">109</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">53</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">37649</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.9297</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span>       <span class="n">Beta</span><span class="p">:</span> <span class="mi">36</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">39045</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.9995</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">13</span><span class="p">,</span>       <span class="n">Beta</span><span class="p">:</span> <span class="mi">34</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">40569</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">102.0758</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">14</span><span class="p">,</span>       <span class="n">Beta</span><span class="p">:</span> <span class="mi">31</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">41228</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">102.1094</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span>       <span class="n">Beta</span><span class="p">:</span> <span class="mi">27</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">38916</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.9868</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">101</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">47</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">40755</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">102.0788</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">31</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">43290</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">102.2055</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">35947</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.8384</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">235</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">91</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">35671</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.8246</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">123</span><span class="p">,</span>      <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">129</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">37756</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.9288</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">29</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">38434</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.9627</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">37082</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.8966</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="mi">19</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">39526</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">102.0187</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="mi">53</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">BaseStrategy</span>     <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">29228</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.4826</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">125</span><span class="p">,</span>       <span class="n">Beta</span><span class="p">:</span> <span class="mi">97</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>    <span class="n">Value</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>       <span class="n">Price</span><span class="p">:</span> <span class="mf">100.0000</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">0</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">3277</span><span class="p">,</span>    <span class="n">Price</span><span class="p">:</span> <span class="mf">100.1639</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">41</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">6159</span><span class="p">,</span>    <span class="n">Price</span><span class="p">:</span> <span class="mf">100.3079</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">34</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">9008</span><span class="p">,</span>    <span class="n">Price</span><span class="p">:</span> <span class="mf">100.4504</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">34</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">12274</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.6137</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">28</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">14189</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.7094</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">26</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1800000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">15451</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.7752</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">28</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">12494</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.6273</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">124</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1800000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">23384</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.1967</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">204</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">16414</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.8372</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">53</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">22887</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.1609</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">36</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">24681</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.2506</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">34</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">26080</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.3205</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="mi">31</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">26954</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.3647</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">27</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">25008</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.2611</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">47</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">27730</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.3972</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">31</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">30112</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.5163</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">22951</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.1582</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span><span class="p">,</span>        <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">91</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">15553</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.7884</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">129</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">18657</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.9436</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">29</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">19441</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.9827</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">17903</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.9072</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">19</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">2000000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">20524</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">101.0383</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">53</span>
 <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="n">End</span>   <span class="n">HedgedStrategy</span>   <span class="n">Notional</span><span class="p">:</span>  <span class="mi">1900000</span><span class="p">,</span>      <span class="n">Value</span><span class="p">:</span> <span class="mi">14170</span><span class="p">,</span>   <span class="n">Price</span><span class="p">:</span> <span class="mf">100.7071</span>
 <span class="n">Risk</span><span class="p">:</span>       <span class="n">PVBP</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>         <span class="n">Beta</span><span class="p">:</span> <span class="mi">97</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Total PNL time series values</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
               <span class="s1">&#39;hedged&#39;</span><span class="p">:</span><span class="n">hedge_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
               <span class="s1">&#39;top&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="s1">&#39;TopStrategy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
               <span class="s1">&#39;bottom&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="s1">&#39;BottomStrategy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
            <span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<a class="pynb reference internal image-reference" href="_images/Fixed_Income_18_0.png"><img alt="_images/Fixed_Income_18_0.png" class="pynb" src="_images/Fixed_Income_18_0.png" style="width: 395px; height: 266px;" /></a>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Total pvbp time series values</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;pvbp&#39;</span><span class="p">],</span>
               <span class="s1">&#39;hedged&#39;</span><span class="p">:</span><span class="n">hedge_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;pvbp&#39;</span><span class="p">],</span>
               <span class="s1">&#39;top&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="s1">&#39;TopStrategy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;pvbp&#39;</span><span class="p">],</span>
               <span class="s1">&#39;bottom&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="s1">&#39;BottomStrategy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;pvbp&#39;</span><span class="p">]}</span>
            <span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<a class="pynb reference internal image-reference" href="_images/Fixed_Income_19_0.png"><img alt="_images/Fixed_Income_19_0.png" class="pynb" src="_images/Fixed_Income_19_0.png" style="width: 383px; height: 248px;" /></a>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Total beta time series values</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">],</span>
               <span class="s1">&#39;hedged&#39;</span><span class="p">:</span><span class="n">hedge_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">],</span>
               <span class="s1">&#39;top&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="s1">&#39;TopStrategy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">],</span>
               <span class="s1">&#39;bottom&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="s1">&#39;BottomStrategy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">risks</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]}</span>
            <span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<a class="pynb reference internal image-reference" href="_images/Fixed_Income_20_0.png"><img alt="_images/Fixed_Income_20_0.png" class="pynb" src="_images/Fixed_Income_20_0.png" style="width: 383px; height: 248px;" /></a>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &quot;Price&quot; time series values</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">prices</span><span class="p">,</span>
               <span class="s1">&#39;hedged&#39;</span><span class="p">:</span><span class="n">hedge_test</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">prices</span><span class="p">,</span>
               <span class="s1">&#39;top&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="s1">&#39;TopStrategy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prices</span><span class="p">,</span>
               <span class="s1">&#39;bottom&#39;</span><span class="p">:</span><span class="n">base_test</span><span class="o">.</span><span class="n">strategy</span><span class="p">[</span><span class="s1">&#39;BottomStrategy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prices</span><span class="p">}</span>
            <span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<a class="pynb reference internal image-reference" href="_images/Fixed_Income_21_0.png"><img alt="_images/Fixed_Income_21_0.png" class="pynb" src="_images/Fixed_Income_21_0.png" style="width: 377px; height: 262px;" /></a>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show transactions</span>
<span class="n">out</span><span class="o">.</span><span class="n">get_transactions</span><span class="p">(</span><span class="s1">&#39;HedgedBacktest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="pynb-result">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>price</th>
      <th>quantity</th>
    </tr>
    <tr>
      <th>Date</th>
      <th>Security</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="20" valign="top">2020-01-01</th>
      <th>corp0000</th>
      <td>1.009697</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>corp0001</th>
      <td>0.991417</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0002</th>
      <td>1.016553</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>corp0005</th>
      <td>1.035779</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>corp0009</th>
      <td>1.014195</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0015</th>
      <td>0.849097</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0017</th>
      <td>1.018107</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>corp0018</th>
      <td>1.009549</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0019</th>
      <td>0.908531</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0023</th>
      <td>1.216847</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0024</th>
      <td>1.094375</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>corp0025</th>
      <td>1.054762</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>corp0030</th>
      <td>0.888091</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0032</th>
      <td>1.086487</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>corp0035</th>
      <td>0.996676</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0036</th>
      <td>1.070212</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>corp0037</th>
      <td>0.992530</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0044</th>
      <td>0.959150</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>corp0048</th>
      <td>0.987408</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>corp0049</th>
      <td>1.016879</td>
      <td>-100000.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
        <aside>

            
            <a href="index.html" id="logo" title=bt><img class="logo" src="_static/logo.png" width="150px" height="150px" title=bt /></a>
            
            
            <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html"> Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html"> Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="algos.html"> All About Algos</a></li>
<li class="toctree-l1"><a class="reference internal" href="tree.html"> The Tree Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html"> Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="bt.html"> API</a></li>
</ul>


            
            <ul>
                <li><a href="https://github.com/pmorissette/bt">Github</a></li>
            </ul>
            
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </aside>
    
      <div class="clearer"></div>
    </div>
        <div class="footer">
            bt was created by Philippe Morissette.
If you find a bug, please <a href="https://github.com/pmorissette/bt/issues/new" title="Open a new issue on Github">submit an issue</a> on Github.

        </div>

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-52308448-3', 'auto');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
        
  </body>
</html>